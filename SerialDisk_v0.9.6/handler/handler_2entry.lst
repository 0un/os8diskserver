    1             /SERIAL-BASED DISK SYSTEM
    2             /KYLE OWEN - 1/28/2014
    3             
    4       0003  VERS="C&77
    5             
    6       6400  BASER=6400
    7       6410  BASET=6410
    8             /BASER=6030
    9             /BASET=6040
   10             
   11       6400  SKCF=BASER
   12       6401  SKSF=BASER+1
   13       6402  SKCC=BASER+2
   14       6404  SKRS=BASER+4
   15       6405  SKIE=BASER+5
   16       6406  SKRB=BASER+6
   17             
   18       6410  STFL=BASET
   19       6411  STSF=BASET+1
   20       6412  STCF=BASET+2
   21       6414  STPC=BASET+4
   22       6415  STSK=BASET+5
   23       6416  STLS=BASET+6
   24             
   25       6260  BLKNUM=6260
   26             
   27             /A OR B - COMMAND SERVER, SIDE 0 OR 1
   28             /@ - SEND BOOT CODE
   29             
   30       0000          *0
   31 00000 7775          -3              /THREE DEVICES
   32 00001 2322          DEVICE SRV; DEVICE SYS;  4640; ENTRY1&177+2000; 0; BLKNUM
      00002 2600
      00003 2331
      00004 2300
      00005 4640
      00006 2007
      00007 0000
      00010 6260
   33 00011 2322          DEVICE SRV; DEVICE SRV1; 4640; ENTRY1&177+1000; 0; BLKNUM
      00012 2600
      00013 2322
      00014 2661
      00015 4640
      00016 1007
      00017 0000
      00020 6260
   34 00021 2322          DEVICE SRV; DEVICE SRV2; 4640; ENTRY2&177+1000; 0; BLKNUM
      00022 2600
      00023 2322
      00024 2662
      00025 4640
      00026 1060
      00027 0000
      00030 6260



      /SERIAL-BASED DISK SYSTEM                                           Page 1


   35 00031 7732          BOOT-ENDB
   36             
   37                     RELOC 0
   38             
   39 00000 7200  BOOT,   CLA
   40 00001 1413          TAD I BOOTX1    /COPY FROM 00200-00400 TO 07600-00000
   41 00002 3414          DCA I BOOTX2
   42 00003 1415          TAD I BOOTX3    /COPY FROM 00047-00247 TO 17647-10047
   43 00004 6211          CDF 10
   44 00005 3416          DCA I BOOTX4
   45 00006 6201          CDF 0
   46 00007 1014          TAD BOOTX2
   47 00010 7640          SZA CLA         /DONE?
   48 00011 5001          JMP BOOT+1      /NO, KEEP COPYING
   49 00012 5444          JMP I B7605     /JUMP TO OS/8
   50 00013 0177  BOOTX1, 177
   51 00014 7577  BOOTX2, 7577
   52 00015 0046  BOOTX3, 46
   53 00016 7646  BOOTX4, 7646
   54 00017 0017  ADDR,   17
   55                     ZBLOCK 20-.
   56 00020 7240          CLA CMA         /AC=7777
   57 00021 3017          DCA ADDR        /SET UP ADDRESS
   58 00022 1045          TAD BOOTMS      /SEND BOOT MESSAGE TO SERVER
   59 00023 6416          STLS
   60 00024 6411          STSF
   61 00025 5024          JMP .-1
   62 00026 6402  RDLP,   SKCC            /CLEAR AC AND FLAG
   63 00027 6401          SKSF            /SKIP IF FLAG SET
   64 00030 5027          JMP .-1
   65 00031 6406          SKRB            /READ BUFFER
   66 00032 7106          CLL RTL         /ROTATE 6 LEFT
   67 00033 7006          RTL
   68 00034 7510          SPA             /CHANNEL 8 PUNCHED?
   69 00035 5000          JMP BOOT        /YES, CONTINUE BOOTING
   70 00036 7006          RTL
   71 00037 6401          SKSF            /SKIP IF FLAG SET
   72 00040 5037          JMP .-1
   73 00041 6404          SKRS            /OR BUFFER WITH AC
   74 00042 3417          DCA I ADDR      /STORE CONTENTS
   75 00043 5026          JMP RDLP        /KEEP LOOPING
   76 00044 7605  B7605,  7605            /ADDRESS OF OS/8 ENTRY
   77 00045 0100  BOOTMS, 100             /"@" COMMAND TO SERVER
   78             ENDB,   RELOC
   79             
   80       0200          *200
   81                     RELOC 7600
   82 07600 0000          ZBLOCK 7
      07601 0000
      07602 0000



      /SERIAL-BASED DISK SYSTEM                                           Page 2


      07603 0000
      07604 0000
      07605 0000
      07606 0000
   83 07607 0003  ENTRY1, VERS
   84 07610 7300          CLA CLL         /CLEAR LINK FOR FIRST PLATTER
   85 07611 6400  SETUP,  SKCF            /CLEAR RECEIVE FLAG
   86 07612 1336          TAD WKUP        /ADD WAKEUP CHARACTER
   87 07613 4266          JMS SENDC       /SEND WAKEUP CHARACTER
   88 07614 7200          CLA
   89 07615 6214          RDF             /GET CURRENT FIELD
   90 07616 1333          TAD SCDI        /ADD CDI
   91 07617 3327          DCA SFIELD      /DEPOSIT MODIFIED CIF
   92                     /SKSF           /WAIT FOR RESPONSE
   93                     /JMP .-1
   94                     /SKCF           /CLEAR FLAG
   95 07620 1607          TAD I ENTRY1    /GET FUNCTION
   96 07621 4273          JMS SNDNUM      /TELL SERVER FUNCTION
   97 07622 2207          ISZ ENTRY1      /LOOK AT BUFFER ADDRESS
   98 07623 1607          TAD I ENTRY1    /GET BUFFER ADDRESS
   99 07624 4273          JMS SNDNUM      /TELL SERVER BUFFER ADDRESS
  100 07625 1607          TAD I ENTRY1    /GET BUFFER ADDRESS
  101 07626 3334          DCA SLOC        /STORE BUFFER ADDRESS
  102 07627 2207          ISZ ENTRY1      /LOOK AT STARTING BLOCK NUMBER
  103 07630 1607          TAD I ENTRY1    /GET STARTING BLOCK NUMBER
  104 07631 4273          JMS SNDNUM      /TELL SERVER STARTING BLOCK NUMBER
  105 07632 2207          ISZ ENTRY1      /LOOK AT ERROR RETURN
  106 07633 4301          JMS GETNUM      /RECEIVE CDF INSTRUCTION
  107 07634 3250          DCA CDFSTO
  108 07635 4301          JMS GETNUM      /RECEIVE NEGATIVE WORD COUNT
  109 07636 3335          DCA WORDCT
  110 07637 4301  GETACK, JMS GETNUM      /4000=READ, 4001=WRITE, 0000=DONE, 2000=ERROR
  111 07640 7450          SNA             /WAS IT ZERO?
  112 07641 5326          JMP EXIT        /YES, EXIT
  113 07642 7104          CLL RAL         /NO, IS HIGH BIT SET?
  114 07643 7420          SNL
  115 07644 5331          JMP ERROR       /NO, ERROR!
  116 07645 7640          SZA CLA         /YES, READ OR WRITE?
  117 07646 5313          JMP TXPG        /TIME TO WRITE
  118             
  119 07647 4301  RXLP,   JMS GETNUM      /GET WORD
  120 07650 7402  CDFSTO, HLT             /MODIFIED TO CDF
  121 07651 3734          DCA I SLOC      /STORE CONTENTS
  122 07652 6201          CDF 0
  123 07653 2334          ISZ SLOC        /NEXT LOCATION
  124 07654 7000          NOP
  125 07655 2335          ISZ WORDCT      /INCREMENT WORD COUNT...DONE?
  126 07656 5247          JMP RXLP        /NO, KEEP LOOPING
  127 07657 5237          JMP GETACK      /ANY OTHER REQUESTS?
  128             



      /SERIAL-BASED DISK SYSTEM                                           Page 3


  129 07660 0003  ENTRY2, VERS            /SECOND ENTRY POINT
  130 07661 7200          CLA
  131 07662 1260          TAD ENTRY2      /GET ARGUMENT ADDRESS
  132 07663 3207          DCA ENTRY1      /STORE IT IN COMMON PLACE
  133 07664 7301          CLA CLL IAC     /SET AC = 1 FOR 2ND PLATTER
  134 07665 5211          JMP SETUP       /CONTINUE WITH SETUP
  135             
  136 07666 0000  SENDC,  0               /SEND CHARACTER IN AC
  137 07667 6416          STLS
  138 07670 6411          STSF
  139 07671 5270          JMP .-1
  140 07672 5666          JMP I SENDC
  141                     
  142 07673 0000  SNDNUM, 0               /SEND NUMBER AS TWO CONSECUTIVE CHARACTERS
  143 07674 4266          JMS SENDC       /SEND BOTTOM 8 BITS OF WORD
  144 07675 7002          BSW             /SEND TOP 6 BITS OF WORD PLUS SOME, LET SERVER HANDLE IT
  145 07676 4266          JMS SENDC
  146 07677 7200          CLA
  147 07700 5673          JMP I SNDNUM
  148             
  149 07701 0000  GETNUM, 0
  150 07702 6402          SKCC            /CLEAR AC AND FLAG
  151 07703 6401          SKSF            /SKIP IF FLAG SET
  152 07704 5303          JMP .-1
  153 07705 6406          SKRB            /READ BUFFER
  154 07706 7002          BSW             /SWAP BYTES
  155 07707 6401          SKSF            /SKIP IF FLAG SET
  156 07710 5307          JMP .-1
  157 07711 6404          SKRS            /OR BUFFER WITH AC
  158 07712 5701          JMP I GETNUM
  159             
  160 07713 1250  TXPG,   TAD CDFSTO      /GET DATA FIELD
  161 07714 3315          DCA TXCDF       /MODIFY CDF FOR TRANSFER
  162 07715 7402  TXCDF,  HLT             /MODIFIED TO CDF
  163 07716 1734          TAD I SLOC      /GET WORD
  164 07717 6201          CDF 0           /BACK TO FIELD 0
  165 07720 2334          ISZ SLOC        /NEXT LOCATION
  166 07721 7000          NOP
  167 07722 4273          JMS SNDNUM      /SEND IT
  168 07723 2335          ISZ WORDCT      /INCREMENT WORD COUNT...DONE?
  169 07724 5315          JMP TXCDF       /NO, KEEP LOOPING
  170 07725 5237          JMP GETACK      /ANY MORE REQUESTS?
  171             
  172 07726 2207  EXIT,   ISZ ENTRY1      /NORMAL EXIT
  173 07727 7402  SFIELD, HLT             /MODIFIED TO CDI
  174 07730 5607          JMP I ENTRY1    /EXIT WITH FATAL ERROR
  175 07731 7130  ERROR,  CLL CML RAR     /ROTATE ERROR CODE AND SET NEGATIVE BIT
  176 07732 5327          JMP SFIELD      /ERROR EXIT
  177                     
  178 07733 6203  SCDI,   CIF CDF 0



      /SERIAL-BASED DISK SYSTEM                                           Page 4


  179 07734 0000  SLOC,   0
  180 07735 0000  WORDCT, 0
  181 07736 0101  WKUP,   101
  182 07737 0000          ZBLOCK 7743-.
      07740 0000
      07741 0000
      07742 0000
  183                     RELOC
  184             $

      No detected errors
