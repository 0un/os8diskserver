    1             /SERIAL-BASED DISK SYSTEM
    2             /KYLE OWEN - 1/28/2014
    3             
    4       0001  VERS="A&77
    5             
    6       6400  BASER=6400
    7       6410  BASET=6410
    8             /BASER=6030
    9             /BASET=6040
   10             
   11       6400  SKCF=BASER
   12       6401  SKSF=BASER+1
   13       6402  SKCC=BASER+2
   14       6404  SKRS=BASER+4
   15       6405  SKIE=BASER+5
   16       6406  SKRB=BASER+6
   17             
   18       6410  STFL=BASET
   19       6411  STSF=BASET+1
   20       6412  STCF=BASET+2
   21       6414  STPC=BASET+4
   22       6415  STSK=BASET+5
   23       6416  STLS=BASET+6
   24             
   25       6260  BLKNUM=6260
   26             
   27             /A, B, C OR D FOR 1ST, 2ND, 3RD OR 4TH SIDE OF DISK
   28             
   29       0000          *0
   30 00000 7774          -4              /FOUR DEVICES
   31 00001 2304          DEVICE SDSK; DEVICE SD1; 4640; ENTRY1&177; 0; 0
      00002 2313
      00003 2304
      00004 6100
      00005 4640
      00006 0045
      00007 0000
      00010 0000
   32 00011 2304          DEVICE SDSK; DEVICE SD2; 4640; ENTRY2&177; 0; 0
      00012 2313
      00013 2304
      00014 6200
      00015 4640
      00016 0116
      00017 0000
      00020 0000
   33 00021 2304          DEVICE SDSK; DEVICE SD3; 4640; ENTRY3&177; 0; 0
      00022 2313
      00023 2304
      00024 6300
      00025 4640
      00026 0123
      00027 0000
      00030 0000
   34 00031 2304          DEVICE SDSK; DEVICE SD4; 4640; ENTRY4&177; 0; 0



      /SERIAL-BASED DISK SYSTEM                                           Page 1


      00032 2313
      00033 2304
      00034 6400
      00035 4640
      00036 0130
      00037 0000
      00040 0000
   35                     
   36       0200          *200
   37 00200 0000  SENDC,  0               /SEND CHARACTER IN AC
   38 00201 6416          STLS
   39 00202 6411          STSF
   40 00203 5202          JMP .-1
   41 00204 5600          JMP I SENDC
   42                     
   43 00205 0000  SNDNUM, 0               /SEND NUMBER AS TWO CONSECUTIVE CHARACTERS
   44 00206 4200          JMS SENDC       /SEND BOTTOM 8 BITS OF WORD
   45 00207 7002          BSW             /SEND TOP 6 BITS OF WORD PLUS SOME, LET SERVER HANDLE IT
   46 00210 4200          JMS SENDC
   47 00211 7200          CLA
   48 00212 5605          JMP I SNDNUM
   49             
   50 00213 0000  GETNUM, 0
   51 00214 6402          SKCC            /CLEAR AC AND FLAG
   52 00215 6401          SKSF            /SKIP IF FLAG SET
   53 00216 5215          JMP .-1
   54 00217 6406          SKRB            /READ BUFFER
   55 00220 7002          BSW             /SWAP BYTES
   56 00221 6401          SKSF            /SKIP IF FLAG SET
   57 00222 5221          JMP .-1
   58 00223 6404          SKRS            /OR BUFFER WITH AC
   59 00224 5613          JMP I GETNUM
   60             
   61 00225 1306  TXPG,   TAD CDFSTO      /GET DATA FIELD
   62 00226 3227          DCA TXCDF       /MODIFY CDF FOR TRANSFER
   63 00227 7402  TXCDF,  HLT             /MODIFIED TO CDF
   64 00230 1736          TAD I SLOC      /GET WORD
   65 00231 6201          CDF 0           /BACK TO FIELD 0
   66 00232 2336          ISZ SLOC        /NEXT LOCATION
   67 00233 7000          NOP
   68 00234 4205          JMS SNDNUM      /SEND IT
   69 00235 2337          ISZ WORDCT      /INCREMENT WORD COUNT...DONE?
   70 00236 5227          JMP TXCDF       /NO, KEEP LOOPING
   71 00237 5275          JMP GETACK      /ANY MORE REQUESTS?
   72             
   73 00240 2245  EXIT,   ISZ ENTRY1      /NORMAL EXIT
   74 00241 7402  SFIELD, HLT             /MODIFIED TO CDI
   75 00242 5645          JMP I ENTRY1    /EXIT WITH FATAL ERROR
   76 00243 7130  ERROR,  CLL CML RAR     /ROTATE ERROR CODE AND SET NEGATIVE BIT
   77 00244 5241          JMP SFIELD      /ERROR EXIT



      /SERIAL-BASED DISK SYSTEM                                           Page 2


   78             
   79 00245 0001  ENTRY1, VERS
   80 00246 7300          CLA CLL         /CLEAR LINK FOR FIRST PLATTER
   81 00247 6400  SETUP,  SKCF            /CLEAR RECEIVE FLAG
   82 00250 1340          TAD WKUP        /ADD WAKEUP CHARACTER
   83 00251 4200          JMS SENDC       /SEND WAKEUP CHARACTER
   84 00252 7200          CLA
   85 00253 6214          RDF             /GET CURRENT FIELD
   86 00254 1335          TAD SCDI        /ADD CDI
   87 00255 3241          DCA SFIELD      /DEPOSIT MODIFIED CIF
   88                     /SKSF           /WAIT FOR RESPONSE
   89                     /JMP .-1
   90                     /SKCF           /CLEAR FLAG
   91 00256 1645          TAD I ENTRY1    /GET FUNCTION
   92 00257 4205          JMS SNDNUM      /TELL SERVER FUNCTION
   93 00260 2245          ISZ ENTRY1      /LOOK AT BUFFER ADDRESS
   94 00261 1645          TAD I ENTRY1    /GET BUFFER ADDRESS
   95 00262 4205          JMS SNDNUM      /TELL SERVER BUFFER ADDRESS
   96 00263 1645          TAD I ENTRY1    /GET BUFFER ADDRESS
   97 00264 3336          DCA SLOC        /STORE BUFFER ADDRESS
   98 00265 2245          ISZ ENTRY1      /LOOK AT STARTING BLOCK NUMBER
   99 00266 1645          TAD I ENTRY1    /GET STARTING BLOCK NUMBER
  100 00267 4205          JMS SNDNUM      /TELL SERVER STARTING BLOCK NUMBER
  101 00270 2245          ISZ ENTRY1      /LOOK AT ERROR RETURN
  102 00271 4213          JMS GETNUM      /RECEIVE CDF INSTRUCTION
  103 00272 3306          DCA CDFSTO
  104 00273 4213          JMS GETNUM      /RECEIVE NEGATIVE WORD COUNT
  105 00274 3337          DCA WORDCT
  106 00275 4213  GETACK, JMS GETNUM      /4000=READ, 4001=WRITE, 0000=DONE, 2000=ERROR
  107 00276 7450          SNA             /WAS IT ZERO?
  108 00277 5240          JMP EXIT        /YES, EXIT
  109 00300 7104          CLL RAL         /NO, IS HIGH BIT SET?
  110 00301 7420          SNL
  111 00302 5243          JMP ERROR       /NO, ERROR!
  112 00303 7640          SZA CLA         /YES, READ OR WRITE?
  113 00304 5225          JMP TXPG        /TIME TO WRITE
  114             
  115 00305 4213  RXLP,   JMS GETNUM      /GET WORD
  116 00306 7402  CDFSTO, HLT             /MODIFIED TO CDF
  117 00307 3736          DCA I SLOC      /STORE CONTENTS
  118 00310 6201          CDF 0
  119 00311 2336          ISZ SLOC        /NEXT LOCATION
  120 00312 7000          NOP
  121 00313 2337          ISZ WORDCT      /INCREMENT WORD COUNT...DONE?
  122 00314 5305          JMP RXLP        /NO, KEEP LOOPING
  123 00315 5275          JMP GETACK      /ANY OTHER REQUESTS?
  124             
  125 00316 0001  ENTRY2, VERS            /SECOND ENTRY POINT
  126 00317 7301          CLA CLL IAC     /SET AC = 1 FOR 2ND PLATTER
  127 00320 1316          TAD ENTRY2      /GET ARGUMENT ADDRESS



      /SERIAL-BASED DISK SYSTEM                                           Page 3


  128 00321 3245          DCA ENTRY1      /STORE IT IN COMMON PLACE
  129 00322 5247          JMP SETUP       /CONTINUE WITH SETUP
  130             
  131 00323 0001  ENTRY3, VERS
  132 00324 7305          CLA CLL IAC RAL /SET AC = 2 FOR 3RD PLATTER
  133 00325 1323          TAD ENTRY3      /GET ARGUMENT ADDRESS
  134 00326 3245          DCA ENTRY1      /STORE IT IN COMMON PLACE
  135 00327 5247          JMP SETUP       /CONTINUE WITH SETUP
  136             
  137 00330 0001  ENTRY4, VERS
  138 00331 7325          CLA CLL CML IAC RAL     /SET AC = 3 FOR 4TH PLATTER
  139 00332 1323          TAD ENTRY3      /GET ARGUMENT ADDRESS
  140 00333 3245          DCA ENTRY1      /STORE IT IN COMMON PLACE
  141 00334 5247          JMP SETUP       /CONTINUE WITH SETUP
  142             
  143 00335 6203  SCDI,   CIF CDF 0
  144 00336 0000  SLOC,   0
  145 00337 0000  WORDCT, 0
  146 00340 0101  WKUP,   101             /'A'
  147 00341 0000          ZBLOCK 377-.
      00342 0000
      00343 0000
      00344 0000
      00345 0000
      00346 0000
      00347 0000
      00350 0000
      00351 0000
      00352 0000
      00353 0000
      00354 0000
      00355 0000
      00356 0000
      00357 0000
      00360 0000
      00361 0000
      00362 0000
      00363 0000
      00364 0000
      00365 0000
      00366 0000
      00367 0000
      00370 0000
      00371 0000
      00372 0000
      00373 0000
      00374 0000
      00375 0000
      00376 0000
  148             $

      No detected errors
