    1             /SERIAL-BASED DISK SYSTEM
    2             /SYSTEM HANDLER FOR OMNIBUS
    3             /KYLE OWEN - 2/17/2014
    4             
    5       0004  VERS="D&77
    6             
    7       6400  BASER=6400
    8       6410  BASET=6410
    9             
   10       6400  SKCF=BASER
   11       6401  SKSF=BASER+1
   12       6402  SKCC=BASER+2
   13       6404  SKRS=BASER+4
   14       6405  SKIE=BASER+5
   15       6406  SKRB=BASER+6
   16             
   17       6410  STFL=BASET
   18       6411  STSF=BASET+1
   19       6412  STCF=BASET+2
   20       6414  STPC=BASET+4
   21       6415  STSK=BASET+5
   22       6416  STLS=BASET+6
   23             
   24       6260  BLKNUM=6260
   25             
   26             /HANDLER SENDS:
   27             /A OR B - COMMAND SERVER, SIDE 0 OR 1
   28             /@ - SEND BOOT CODE
   29             
   30       0000          *0
   31 00000 7775          -3              /THREE DEVICES
   32 00001 2304          DEVICE SDSK; DEVICE SYS;  4640; ENTRY1&177+2000; 0; BLKNUM
      00002 2313
      00003 2331
      00004 2300
      00005 4640
      00006 2007
      00007 0000
      00010 6260
   33 00011 2304          DEVICE SDSK; DEVICE SDA0; 4640; ENTRY1&177+1000; 0; BLKNUM
      00012 2313
      00013 2304
      00014 0160
      00015 4640
      00016 1007
      00017 0000
      00020 6260
   34 00021 2304          DEVICE SDSK; DEVICE SDB0; 4640; ENTRY2&177+1000; 0; BLKNUM
      00022 2313
      00023 2304
      00024 0260
      00025 4640
      00026 1057
      00027 0000
      00030 6260



      /SERIAL-BASED DISK SYSTEM                                           Page 1


   35 00031 7732          BOOT-ENDB
   36             
   37                     RELOC 0
   38             
   39 00000 7200  BOOT,   CLA
   40 00001 1413          TAD I BOOTX1    /COPY FROM 00200-00400 TO 07600-00000
   41 00002 3414          DCA I BOOTX2
   42 00003 1415          TAD I BOOTX3    /COPY FROM 00047-00247 TO 17647-10047
   43 00004 6211          CDF 10
   44 00005 3416          DCA I BOOTX4
   45 00006 6201          CDF 0
   46 00007 1014          TAD BOOTX2
   47 00010 7640          SZA CLA         /DONE?
   48 00011 5001          JMP BOOT+1      /NO, KEEP COPYING
   49 00012 5444          JMP I B7605     /JUMP TO OS/8
   50 00013 0177  BOOTX1, 177
   51 00014 7577  BOOTX2, 7577
   52 00015 0046  BOOTX3, 46
   53 00016 7646  BOOTX4, 7646
   54 00017 0017  ADDR,   17
   55                     ZBLOCK 20-.
   56 00020 7240          CLA CMA         /AC=7777
   57 00021 3017          DCA ADDR        /SET UP ADDRESS
   58 00022 1045          TAD BOOTMS      /SEND BOOT MESSAGE TO SERVER
   59 00023 6416          STLS
   60 00024 6411          STSF
   61 00025 5024          JMP .-1
   62 00026 6402  RDLP,   SKCC            /CLEAR AC AND FLAG
   63 00027 6401          SKSF            /SKIP IF FLAG SET
   64 00030 5027          JMP .-1
   65 00031 6406          SKRB            /READ BUFFER
   66 00032 7106          CLL RTL         /ROTATE 6 LEFT
   67 00033 7006          RTL
   68 00034 7510          SPA             /CHANNEL 8 PUNCHED?
   69 00035 5000          JMP BOOT        /YES, CONTINUE BOOTING
   70 00036 7006          RTL
   71 00037 6401          SKSF            /SKIP IF FLAG SET
   72 00040 5037          JMP .-1
   73 00041 6404          SKRS            /OR BUFFER WITH AC
   74 00042 3417          DCA I ADDR      /STORE CONTENTS
   75 00043 5026          JMP RDLP        /KEEP LOOPING
   76 00044 7605  B7605,  7605            /ADDRESS OF OS/8 ENTRY
   77 00045 0100  BOOTMS, 100             /"@" COMMAND TO SERVER
   78             ENDB,   RELOC
   79             
   80       0200          *200
   81                     RELOC 7600
   82 07600 0000          ZBLOCK 7
      07601 0000
      07602 0000



      /SERIAL-BASED DISK SYSTEM                                           Page 2


      07603 0000
      07604 0000
      07605 0000
      07606 0000
   83 07607 0004  ENTRY1, VERS
   84 07610 7300          CLA CLL         /CLEAR LINK FOR FIRST PLATTER
   85 07611 1335  SETUP,  TAD WKUP        /ADD WAKEUP CHARACTER
   86 07612 4265          JMS SENDC       /SEND WAKEUP CHARACTER
   87 07613 7200          CLA
   88 07614 6214          RDF             /GET CURRENT FIELD
   89 07615 1332          TAD SCDI        /ADD CDI
   90 07616 3326          DCA SFIELD      /DEPOSIT MODIFIED CIF
   91 07617 1607          TAD I ENTRY1    /GET FUNCTION
   92 07620 4272          JMS SNDNUM      /TELL SERVER FUNCTION
   93 07621 2207          ISZ ENTRY1      /LOOK AT BUFFER ADDRESS
   94 07622 1607          TAD I ENTRY1    /GET BUFFER ADDRESS
   95 07623 4272          JMS SNDNUM      /TELL SERVER BUFFER ADDRESS
   96 07624 1607          TAD I ENTRY1    /GET BUFFER ADDRESS
   97 07625 3333          DCA SLOC        /STORE BUFFER ADDRESS
   98 07626 2207          ISZ ENTRY1      /LOOK AT STARTING BLOCK NUMBER
   99 07627 1607          TAD I ENTRY1    /GET STARTING BLOCK NUMBER
  100 07630 4272          JMS SNDNUM      /TELL SERVER STARTING BLOCK NUMBER
  101 07631 2207          ISZ ENTRY1      /LOOK AT ERROR RETURN
  102 07632 4300          JMS GETNUM      /RECEIVE CDF INSTRUCTION
  103 07633 3247          DCA CDFSTO
  104 07634 4300          JMS GETNUM      /RECEIVE NEGATIVE WORD COUNT
  105 07635 3334          DCA WORDCT
  106 07636 4300  GETACK, JMS GETNUM      /4000=READ, 4001=WRITE, 0000=DONE, 2000=ERROR
  107 07637 7450          SNA             /WAS IT ZERO?
  108 07640 5325          JMP EXIT        /YES, EXIT
  109 07641 7104          CLL RAL         /NO, IS HIGH BIT SET?
  110 07642 7420          SNL
  111 07643 5330          JMP ERROR       /NO, ERROR!
  112 07644 7640          SZA CLA         /YES, READ OR WRITE?
  113 07645 5312          JMP TXPG        /TIME TO WRITE
  114             
  115 07646 4300  RXLP,   JMS GETNUM      /GET WORD
  116 07647 7402  CDFSTO, HLT             /MODIFIED TO CDF
  117 07650 3733          DCA I SLOC      /STORE CONTENTS
  118 07651 6201          CDF 0
  119 07652 2333          ISZ SLOC        /NEXT LOCATION
  120 07653 7000          NOP
  121 07654 2334          ISZ WORDCT      /INCREMENT WORD COUNT...DONE?
  122 07655 5246          JMP RXLP        /NO, KEEP LOOPING
  123 07656 5236          JMP GETACK      /ANY OTHER REQUESTS?
  124             
  125 07657 0004  ENTRY2, VERS            /SECOND ENTRY POINT
  126 07660 7200          CLA
  127 07661 1257          TAD ENTRY2      /GET ARGUMENT ADDRESS
  128 07662 3207          DCA ENTRY1      /STORE IT IN COMMON PLACE



      /SERIAL-BASED DISK SYSTEM                                           Page 3


  129 07663 7301          CLA CLL IAC     /SET AC = 1 FOR 2ND PLATTER
  130 07664 5211          JMP SETUP       /CONTINUE WITH SETUP
  131             
  132 07665 0000  SENDC,  0               /SEND CHARACTER IN AC
  133 07666 6416          STLS
  134 07667 6411          STSF
  135 07670 5267          JMP .-1
  136 07671 5665          JMP I SENDC
  137                     
  138 07672 0000  SNDNUM, 0               /SEND NUMBER AS TWO CONSECUTIVE CHARACTERS
  139 07673 4265          JMS SENDC       /SEND BOTTOM 8 BITS OF WORD
  140 07674 7002          BSW             /SEND TOP 6 BITS OF WORD PLUS SOME, LET SERVER HANDLE IT
  141 07675 4265          JMS SENDC
  142 07676 7200          CLA
  143 07677 5672          JMP I SNDNUM
  144             
  145 07700 0000  GETNUM, 0
  146 07701 6402          SKCC            /CLEAR AC AND FLAG
  147 07702 6401          SKSF            /SKIP IF FLAG SET
  148 07703 5302          JMP .-1
  149 07704 6406          SKRB            /READ BUFFER
  150 07705 7002          BSW             /SWAP BYTES
  151 07706 6401          SKSF            /SKIP IF FLAG SET
  152 07707 5306          JMP .-1
  153 07710 6404          SKRS            /OR BUFFER WITH AC
  154 07711 5700          JMP I GETNUM
  155             
  156 07712 1247  TXPG,   TAD CDFSTO      /GET DATA FIELD
  157 07713 3314          DCA TXCDF       /MODIFY CDF FOR TRANSFER
  158 07714 7402  TXCDF,  HLT             /MODIFIED TO CDF
  159 07715 1733          TAD I SLOC      /GET WORD
  160 07716 6201          CDF 0           /BACK TO FIELD 0
  161 07717 2333          ISZ SLOC        /NEXT LOCATION
  162 07720 7000          NOP
  163 07721 4272          JMS SNDNUM      /SEND IT
  164 07722 2334          ISZ WORDCT      /INCREMENT WORD COUNT...DONE?
  165 07723 5314          JMP TXCDF       /NO, KEEP LOOPING
  166 07724 5236          JMP GETACK      /ANY MORE REQUESTS?
  167             
  168 07725 2207  EXIT,   ISZ ENTRY1      /NORMAL EXIT
  169 07726 7402  SFIELD, HLT             /MODIFIED TO CDI
  170 07727 5607          JMP I ENTRY1    /EXIT
  171 07730 7130  ERROR,  CLL CML RAR     /ROTATE ERROR CODE AND SET NEGATIVE BIT
  172 07731 5326          JMP SFIELD      /ERROR EXIT
  173                     
  174 07732 6203  SCDI,   CIF CDF 0
  175 07733 0000  SLOC,   0
  176 07734 0000  WORDCT, 0
  177 07735 0101  WKUP,   101
  178 07736 0000          ZBLOCK 7744-.



      /SERIAL-BASED DISK SYSTEM                                           Page 4


      07737 0000
      07740 0000
      07741 0000
      07742 0000
      07743 0000
  179                     RELOC
  180             $

      No detected errors
